<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.supshop.suppingmall.mapper.UserMapper">
    <resultMap id="User" type="com.supshop.suppingmall.user.User" autoMapping="true">
        <id property="userId" column="UserId" />
        <result property="email" column="UserEmail" />
        <result property="password" column="UserPassword" />
        <result property="name" column="Username" />
        <result property="nickName" column="UserNickName" />
        <result property="city" column="UserCity" />
        <result property="cityDetail" column="UserCityDetail" />
        <result property="zipCode" column="UserZipCode" />
        <result property="phoneNumber" column="UserPhoneNumber" />
        <result property="createdDate" column="UserCreatedDate" />
        <result property="updatedDate" column="UserUpdatedDate" />
        <result property="role" column="UserRole" typeHandler="com.supshop.suppingmall.user.RoleTypeHandler" />
        <result property="delYn" column="UserDelYn" />
        <result property="shopName" column="ShopName" />
        <result property="shopNumber" column="ShopNumber" />
        <result property="shopAddress" column="ShopAddress" />
        <result property="shopAddressDetail" column="ShopAddressDetail" />
        <result property="shopPostNo" column="ShopPostNo" />
        <result property="type" column="UserType" typeHandler="com.supshop.suppingmall.user.LoginTypeHandler" />
    </resultMap>

    <select id="selectAllUser" resultMap="User">
        SELECT U.user_id AS "UserId", U.email AS "UserEmail", U.password AS "UserPassword", U.type AS "UserType",
        U.name AS "UserName", U.nickname AS "UserNickName", U.city AS "UserCity", U.city_detail AS "UserCityDetail", U.zipcode AS "UserZipCode",
        U.phone_number AS "UserPhoneNumber", U.created_date AS "UserCreatedDate", U.updated_date AS "UserUpdatedData",
        U.role AS "UserRole", U.delete_yes_or_no AS "UserDelYn", U.shop_name AS "ShopName", U.shop_number AS "ShopNumber",
        U.shop_city AS "ShopAddress", U.shop_city_detail AS "ShopAddressDetail", U.shop_zipcode AS "ShopPostNo"
        FROM User AS U
<!--        <include refid="conditionalSearch"></include>-->
    </select>

    <sql id="conditionalSearch">
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <if test="id != null">
                AND U.user_id = #{id}
            </if>
            <if test="role != null">
                AND U.role = #{role}
            </if>
            <if test="name != null">
                <bind name="name" value="'%'+name+'%'"/>
                AND U.name LIKE #{name}
            </if>
            <if test="type != null">
                AND U.type = #{type}
            </if>
        </trim>
    </sql>

    <select id="selectUser" resultMap="User">
        SELECT U.user_id AS "UserId", U.email AS "UserEmail", U.password AS "UserPassword", U.type AS "UserType",
        U.name AS "UserName", U.nickname AS "UserNickName",U.city AS "UserCity",U.city_detail AS "UserCityDetail", U.zipcode AS "UserZipCode",
        U.phone_number AS "UserPhoneNumber", U.created_date AS "UserCreatedDate", U.updated_date AS "UserUpdatedData",
        U.role AS "UserRole", U.delete_yes_or_no AS "UserDelYn", U.shop_name AS "ShopName", U.shop_number AS "ShopNumber",
        U.shop_city AS "ShopAddress", U.shop_city_detail AS "ShopAddressDetail", U.shop_zipcode AS "ShopPostNo"
        FROM User AS U
        WHERE U.user_id = #{id}
    </select>

    <select id="selectUserByEmail" resultMap="User">
        SELECT U.user_id AS "UserId", U.email AS "UserEmail", U.password AS "UserPassword", U.type AS "UserType",
        U.name AS "UserName", U.nickname AS "UserNickName",U.city AS "UserCity",U.city_detail AS "UserCityDetail", U.zipcode AS "UserZipCode",
        U.phone_number AS "UserPhoneNumber", U.created_date AS "UserCreatedDate", U.updated_date AS "UserUpdatedData",
        U.role AS "UserRole", U.delete_yes_or_no AS "UserDelYn", U.shop_name AS "ShopName", U.shop_number AS "ShopNumber",
        U.shop_city AS "ShopAddress", U.shop_city_detail AS "ShopAddressDetail", U.shop_zipcode AS "ShopPostNo"
        FROM User AS U
        WHERE U.email = #{email}
    </select>

    <insert id="insertUser" parameterType="com.supshop.suppingmall.user.User" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO User(
        email,
        password,
        name,
        nickname,
        city,
        city_detail,
        zipcode,
        phone_number,
        created_date,
        updated_date,
        delete_yes_or_no,
        role,
        type
        )
        VALUES (
        #{email},
        #{password},
        #{name},
        #{nickName},
        #{city},
        #{cityDetail},
        #{zipCode},
        #{phoneNumber},
        now(),
        now(),
        'N',
        #{role, typeHandler=com.supshop.suppingmall.user.RoleTypeHandler},
        #{type, typeHandler=com.supshop.suppingmall.user.LoginTypeHandler}
        )
    </insert>
    
    <update id="updateUser" parameterType="com.supshop.suppingmall.user.User">
        UPDATE User
        SET
        password = #{user.password},
        name = #{user.name},
        nickname = #{user.nickName},
        city = #{user.city},
        downtown = #{user.downtown},
        address = #{user.address},
        address_detail = #{user.addressDetail},
        post_no = #{user.postNo},
        phone_number = #{user.phoneNumber},
        updated_date = now()
        WHERE user_id = #{id};
    </update>
    
</mapper>