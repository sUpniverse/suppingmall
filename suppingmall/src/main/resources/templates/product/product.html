<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/header :: header" />
<head>
    <style>
        ul{
            list-style:none;
            padding: unset;
        }

        img {
            max-width: 900px;
            width: auto;
            height: auto;
        }
    </style>
    <link rel="stylesheet" type="text/css" th:href="@{/css/table.css}" />
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<div class="container">
    <header th:replace="product/product-nav :: product-nav" />
    <nav th:replace="product/product-search :: product-search" />
</div>
<nav class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ol class="breadcrumb mb-0 font-size-xs">
                    <li class="breadcrumb-item">
                        <a href="#" th:text="${product?.category.parent.parent.name}">
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="#" th:text="${product?.category.parent.name}">
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="#" th:text="${product?.category.name}">
                        </a>
                    </li>
                </ol>
            </div>
        </div>
    </div>
</nav>
<section>
    <div class="container">
    <h1 class="mt-2 font-weight-bold" th:text="${product.name}"></h1>
        <hr style="border: solid 1px">
        <div class="row">
            <div class="col-12">
                <div class="row">
                    <div class="col-12 col-md-6">
                        <img th:src="${product.thumbnail}" style="width: auto; height: auto; max-width: 480px;">
                    </div>
                    <div class="col-12 col-md-6 pl-lg-10">
                        <form role="form">
                            <input type="hidden" name="productId" id="productId" th:value="${product.productId}">
                            <input type="hidden" sec:authorize="isAuthenticated()" name="buyerId" id="userId" th:value="${#authentication.principal?.userId}">
                            <input type="hidden" name="sellerId" id="sellerId" th:value="${product.seller.userId}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" name="orderItems" id="orderItemJson">
                            <!-- manufacturer -->
                            <div class="font-weight-bold">
                                <strong class="d-inline-block text-danger" th:text="${product.detail.manufacturer}"></strong>
                            </div>
                            <hr>
                            <!-- price -->
                            <div th:if="${#strings.equals(product.status,product.status.SALE)}">
                                <h4 class="mb-1 font-weight-bold text-muted" th:text="@{${#numbers.formatInteger(product.price,3,'COMMA')}+'원'}"></h4>
                            </div>
                            <div th:unless="${#strings.equals(product.status,product.status.SALE)}">
                                <h4 class="mb-1 font-weight-bold text-danger">현재 판매중인 상품이 아닙니다.</h4>
                            </div>
                            <hr>
                            <p th:text="@{'배송사 : '+${product.deliveryVendor.title}+'  배송비 :' + ${#numbers.formatInteger(product.deliveryPrice,3,'COMMA')}+'원'+' | 도서산간배송비 추가'}"></p>
                            <hr>
                            <!-- origin -->
                            <div class="font-weight-bold" th:text="@{'원산지 :'+${product.detail.origin}}"></div>

                            <hr>
                            <div th:if="${#strings.equals(product.status,product.status.SALE)}">
                                <div>
                                    <label for="product_options">옵션</label>
                                    <select class="form-control" id="product_options" required>
                                        <option disabled selected value>선택하세요</option>
                                        <option th:each="option : ${product.options}" th:value="${option.price}" th:text="${option.optionName}"></option>
                                    </select>
                                </div>
                                <hr>
                                <form th:method="post" action="/orders/">

                                </form>
                                <div th:id="product_composition_last">
                                    <ul th:id="add_option_area"></ul>
                                </div>
                                <div th:id="total_pr" class="mb-4">
                                </div>
                                <div class="btn-group" role="group">
                                    <a type="button" id="cart" class="btn btn-outline-dark">장바구니 담기</a>
                                    <a type="button" id="purchase" class="btn btn-outline-dark">구매하기</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<hr>
<div class="container">
    <nav class="nav nav-pills nav-justified sticky-top bg-white">
        <a class="nav-item nav-link text-dark" href="#contents"><h3>상품정보</h3></a>
        <a class="nav-item nav-link text-dark" href="#review"><h3>상품리뷰 <span class="badge badge-secondary" th:text="${reviews.size()}"></span></h3></a>
        <a class="nav-item nav-link text-dark" href="#qna"><h3>Q&A <span class="badge badge-secondary" th:text="${qnaList.size()}"></span></h3></a>
        <a class="nav-item nav-link text-dark" href="#sellerInfo"><h3>판매자정보</h3></a>
    </nav>
    <div th:id="contents">
        <p th:utext="${product.contents}"></p>
    </div>
    <div class="mt-5" th:id="review">
        <h4>전체리뷰</h4>
        <hr>
        <ul>
            <li th:each="reivew : ${reviews}">
                <p>와우 좋아요!</p>
            </li>
        </ul>
    </div>
    <div class="mt-5" th:id="qna">
        <h4>Q&A</h4>
        <p>구매하시려는 상품에 궁금하신 점이 있으신 경우 문의해 주세요</p>
        <a class="btn btn-dark" href="#" th:href="'javascript:getCreateQnaFom('+${product.productId}+')'" sec:authorize="isAuthenticated()">상품 Q&A 작성하기</a>
        <hr>
        <table class="mt-3 table table-small">
           <thead class="thead-light">
               <tr>
                   <th>답변상태</th>
                   <th>제목</th>
                   <th>작성자</th>
                   <th>작성일</th>
               </tr>
           </thead>
           <tbody>
             <tr th:each="qna : ${qnaList}" th:id="'qna'+${qna.boardId}">
                 <td>

                 </td>
                 <td>
                     <a th:text="${qna.title}" sec:authorize="isAuthenticated()" href="#" th:href="'javascript:getQna('+${qna.boardId}+','+${#authentication.principal.userId}+')'"></a>
                     <a th:text="${qna.title}" sec:authorize="!isAuthenticated()" href="#" th:href="'javascript:getQna('+${qna.boardId}+',undefined)'"></a>
                 </td>
                 <td th:text="${qna.creator.nickName}"></td>
                 <td th:text="${qna.createdDate}"></td>
             </tr>
           </tbody>
        </table>
    </div>

    <div class="mt-5" th:id="sellerInfo">
        <h4>반품/교환 정보</h4>
        <table class="mt-3 table table">
            <tr>
                <th>판매자명</th>
                <td th:text="${product.seller.storeVO.storeName}"></td>
            </tr>
            <tr>
                <th>고객문의 대표번호</th>
                <td th:text="${product.seller.storeVO.storePhoneNumber}">
            </tr>
            <tr>
                <th>반품/교환 배송비</th>
                <td th:text="${product.deliveryPrice}">
            </tr>
            <tr>
                <th>반품/교환지 주소</th>
                <td th:text="@{${product.seller.storeVO.storeZipCode}+' '+${product.seller.storeVO.storeAddress}+' '+${product.seller.storeVO.storeAddressDetail}}">
            </tr>
            <tr>
                <th> 반품/교환 안내</th>
                <td>

                </td>
            </tr>
            <tr>
                <th>
                    반품/교환지 기준
                </th>
                <td>

                </td>
            </tr>
        </table>
    </div>
</div>
</body>
<script type="text/javascript" th:inline="javascript" th:src="@{/js/product/createBuyingList.js}"></script>
<script type="text/javascript" th:inline="javascript" th:src="@{/js/product/setForm.js}"></script>
<script type="text/javascript" th:inline="javascript" th:src="@{/js/product/qna.js}"></script>
<script type="text/javascript" th:inline="javascript" th:src="@{/js/product/editQna.js}"></script>
</html>